#!/bin/sh

# problem: this loop assumes the host is the last non-hyphen arg... is it always?

for ARG in $@
do
        if [[ $ARG != -* ]]; then
                URI_WITH_COLON=$ARG
        fi
done

URI=$(echo $URI_WITH_COLON | sed -r s/:[^:]*//g)

# HOSTNAME=$(echo $URI | sed -r s/^[^@]+@//g)

SCP_CMD="/usr/bin/scp -o PasswordAuthentication=no $@"

$SCP_CMD
RETCODE=$?
# 1: permission denied

if [ $RETCODE -ne 1 ]; then
        # Success
        exit $RETCODE
fi

# If it didn't work, let the ssh script handle why
~/bin/ssh $URI "exit 0"

$SCP_CMD
